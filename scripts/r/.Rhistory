hist(bb$download)
j <- 1
hist(bb$download)
sessionInfo()
measure[j]
sc
sc %>% filter(year == yr)
bb
sc %>% filter(row_number() < 6)
t = popdist_weighted_mean(sc %>% filter(row_number() < 51), bb, measure[j], x_id = 'unitid')
t
sessionInfo()
setwd('~/packages/distRcpp/')
devtools::document()
Rcpp::compileAttributes()
devtools::document()
devtools::build()
devtools::install_github('btskinner/distRcpp')
sessionInfo()
df <- get(data(county_centers))
df
p <- df %>% select(pclon10, pclat10) %>% na.omit %>% data.frame()
library(microbenchmark)
microbenchmark(
    dist_R = distm(p),
    dist_Rcpp = dist_mtom(p[,1],p[,2],p[,1],p[,2],funname="Haversine"),
    times = 100
)
library(geosphere)
microbenchmark(
    dist_R = distm(p),
    dist_Rcpp = dist_mtom(p[,1],p[,2],p[,1],p[,2],funname="Haversine"),
    times = 100
)
quit()
i <- j <- 1
getwd()
setwd('~/packages/distRcpp/')
Rcpp::compileAttributes()
devtools::document()
Rcpp::compileAttributes()
devtools::document()
Rcpp::compileAttributes()
devtools::document()
Rcpp::compileAttributes()
devtools::document()
devtools::test()
devtools::install_github('btskinner/distRcpp')
quit()
i <- j <- 
1
sessionInfo()
out_1 %>% tbl_df()
t = popdist_weighted_mean(x_df = sc %>% filter(row_number() < 1000), y_df = bb, measure_col = measure[j], x_id = 'unitid')
t = popdist_weighted_mean(x_df = sc %>% filter(row_number() < 100), y_df = bb, measure_col = measure[j], x_id = 'unitid')
t
t %>% tbl_df()
sc
with(sc, table(year))
head(out_2 <- 
)
head(out_2)
hist(out_1)
hist(out_1$wmeasure)
hist(out_2$wmeasure)
cor(out_1$measure, out_2$measure)
cor(out_1$wmeasure, out_2$wmeasure)
out = out_1 %>% left_join(out_2)
out = out_1 %>% rename(wm1 = wmeasure) %>% left_join(out_2 %>% rename(wm2 = wmeasure))
out = out %>% tbl_df()
out
library(distRcpp)
popdist_weighted_mean
 detach('package:distRcpp', unload = TRUE)
library.dynam.unload("distRcpp", system.file(package = "distRcpp"))
devtools::load_all('~/packages/distRcpp/')
popdist_weighted_mean
i <- j <- 1
t
t
identical(t$wm1, t$wm2)
all.equal(t$wm1, t$wm2)
quit()
i <- j <- 1
t
t
t %>% rename(unitid = id)
t %>% rename(unitid = id, 'w' %+% measure[j] = mw1)
t %>% rename(unitid = id, `'w' %+% measure[j]` = mw1)
t %>% rename(unitid = id, `'w' %+% measure[j]` = wm1)
t %>% rename_(.dots = setNames('wm1', 'w' %+% measure[j])
)
t %>% rename_(.dots = setNames('wm1', 'w' %+% measure[j]), .dots = setNames('id', 'unitid'))
Reduce(left_join, list(t_1, t_2, t_3))
t_1
quit()
i <- j <- 1
out_1
out_2
quit()
lapply(scbb_list, head)
scbb
scbb
scbb_list
j
i <- j <- 1
out_1
out_2
outlist
outlist[[1]]
outlist[[1]] %>% data.frame(.)
out_1
out_2
out_1
out_2
out_3
out_4
identical(out_1$unitid, out_2$unitid)
out_1
out_2
out_1
dim(out_1)
dim(out_2)
merge(out_1, out_2, by = 'unitid')
out_1$unitid <- as.numeric(out_1$unitid)
out_2$unitid <- as.numeric(out_2$unitid)
out_1 %>% left_join(out_2)
out_1
outlist
lapply(scbb_list, head)
scbb
scbb
propmiss(scbb)
bb
dist_min
yr
out_5
measure[j]
bb %>% select_(measure[j])
bb %>% select_(measure[j], fips)
bb %>% select_(measure[j], 'fips')
out_5
out_4
out_5
out_5
scbb
propmiss(scbb)
data.frame(scbb %>% filter(row_number() < 11))
scbb
propmiss(scbb)\
propmiss(scbb)
hist(scbb %>% filter(year == 2012) %>% .[['near_download']])
hist(scbb %>% filter(year == 2012) %>% .[['pdw1_download']])
summary(scbb %>% filter(year == 2012) %>% .[['near_download']])
summary(scbb %>% filter(year == 2012) %>% .[['pdw1_download']])
summary(scbb %>% filter(year == 2012) %>% .[['pdw2_download']])
summary(scbb %>% filter(year == 2012) %>% .[['dw2_download']])
summary(scbb %>% filter(year == 2012) %>% .[['dw1_download']])
quit()
quit()
second_level_vars
first_level_vars_full
first_level_vars_two
cdir <- '../../../data/cleaned/rq1/'
bb_measures <- 'pdw2_download'
meas <- bb_measures
)
x
df %>% select(pdw2_download)
dim(z)
z
x
df %>% select(pdw2_download) %>% mutate(pdw2_download_sq = pdw2_download^2)
quit()
getwd()
cdir = '../../../data/cleaned/rq1/'
df
meas = 'pdw2_download'
head(y)
head(trials)
center <- function(x) x - mean(x0
center <- function(x) x - mean(x)
xc <- apply(x, 2, center)
head(xc)
glm(c(y, trials) ~ xc, family = 'binomial')
glm(cbind(y, trials) ~ xc, family = 'binomial')
exp(-.25362)
exp(0.0751)
lm(y ~ xc)
lm(log(y) ~ xc + df$lenfetot)
lm(log(y) ~ xc + df$lefdetot)
head(xc)
lm(df$lefdesom ~ xc + df$lefdetot)
lm(y ~ x)
xc <- apply(x, 2, center)
lm(y ~ xc)
glm(cbind(y,trials) ~ x)
glm(cbind(y,trials) ~ x, family = 'binomial')
glm(cbind(y,trials) ~ xc, family = 'binomial')
xc <- apply(x, 2, center)
glm(cbind(y,trials) ~ xc, family = 'binomial')
library(betareg)
betareg(I(y/trials) ~ xc, family = 'binomial')
betareg(I(y/trials) ~ xc)
betareg(I(y/trials) ~ x)
exp(.12)
xc <- apply(x, 2, center)
betareg(I(y/trials) ~ xc)
exp(.19)
head(xc)
glm(cbind(y,trials - y) ~ xc, family = 'binomial')
glm(cbind(y,trials) ~ xc, family = 'binomial')
head(xc)
head(trials)
head(Y)
head(y)
f <- trials - y
head(f)
summary(f)
glm(cbind(y,f) ~ xc, family = 'binomial')
xc <- apply(x, 2, center)
y <- cbind(y, trials-y)
head(y)
glm(y ~ xc, family = binomial)
p <- y / trials
lm(y ~ xc)
lm(p ~ xc)
p <- y[1] / trials
lm(p ~ xc)
betareg(p ~ xc)
summary(p)
dim(trials)
summary(trials)
summary(y)
mean(y > trials)
p <- y / trials
lm(p ~ xc)
betareg(p ~ xc)
exp(.19)
head(xc)
meas <- 'pdw2_upload'
xc_u <- apply(x, 2, center)
betareg(p ~ xc_u)
meas <- 'pdw2_pcount'
xc_c <- apply(x, 2, center)
head(xc_c)
betareg(p ~ xc_c)
xc_d = xc
x
head(x)
df %>% select(pdw2_upload)
betareg(p ~ xc_c)
betareg(p ~ xc)
quit()
cdir <- '../../../data/cleaned/rq1/'
meas <- 'pdw2_download'
center <- function(x - mean(x))
center <- function(x) (x - mean(x))
xc <- center(x)
head(xc)
glm(cbind(y, trials - y) ~ xc, family=binominal)
glm(cbind(y, trials - y) ~ xc, family=binominal())
glm(cbind(y, trials - y) ~ xc, family='binomial')
head(y)
head(trials)
exp(-13.51)
glm(cbind(y, trials - y) ~ xc, family=binomial(link=logit))
library(betareg)
betareg(I(y/trials) ~ xc)
w <- 1 / y / trials
head(w)
summary(w)
summary(trials)
quantile(trials, probs=seq(0,1,.1))
df
df %>% filter(efdetot > 100000)
df %>% filter(unitid == 150987)
df = df %>% filter(unitid != 150987)
df
xc <- center(x)
quantile(trials, probs=seq(0,1,.1))
df %>% filter(efdetot > 50000)
xc <- center(x)
betareg(I(y/trials) ~ xc)
exp(.19)
glm(cbind(y, trials - y) ~ xc, family = binomial)
summary(betareg(I(y/trials) ~ xc))
summary(glm(cbind(y, trials - y) ~ xc, family = binomial))
summary(lm(df$lefdesom ~ xc))
df
propmiss(df)
mean(is.na(df$ctunemrate))
ctunem <- df$ctunemrate
ctunem <- center(ctunem)
xc <- cbind(xc, ctunem)
summary(lm(df$lefdesom ~ xc))
summary(betareg(I(y/trials) ~ xc))
df
dim(xc)
dim(trials)
length(trials)
w <- 1 / trials / sum(trials)
head(w)
glm(cbind(y, trials - y) ~ xc, weights = w)
length(y)
length(trials)
length(w)
dim(xc)
glm(cbind(y, trials - y) ~ xc, weights = w)
length(w)
head(w)
summary(w)
w <- w * 10000
summary(w)
w <-  w * 100000
summary(w)
w <- w * 1000
glm(cbind(y, trials - y) ~ xc, weights = w)
glm(cbind(y, trials - y) ~ xc, weights = TRUE)
table(df$rucc)
glm(cbind(y, trials - y) ~ xc + I(df$rucc))
glm(cbind(y, trials - y) ~ xc))
glm(cbind(y, trials - y) ~ xc)
dim(cbind(y, trials - y))
dim(xc)
head(xc)
is.na(xc)
mean(is.na(xc))
lm(df$lefdesom ~ xc)
lm(df$lefdesom ~ xc + I(df$rucc))
lm(df$lefdesom ~ xc + factor(df$rucc))
summary(lm(df$lefdesom ~ xc + factor(df$rucc)))
summary(glm(cbind(y, trials - y) ~ xc + factor(df$rucc)))
summary(glm(cbind(y, trials - y) ~ xc + factor(df$rucc)))
summary(glm(cbind(y, trials - y) ~ xc + factor(df$rucc), family=binomial))
summary(glm(cbind(y, trials - y) ~ xc + factor(df$rucc), family=binomial), weights = w)
summary(betareg(I(y/trials) ~ xc + factor(df$rucc)))
df
tmp = model.matrix(~ df$rucc - 1)
head(tmp)
tmp = model.matrix(~ rucc - 1, df)
head(tmp)
tmp = model.matrix(~ as.factor(rucc) - 1, df)
head(tmp)
table(df$rucc)
table(df$rucc[df$twoyr == 1])
df
df
table(df$rucc, df$rucc_2, df$rucc_3)
xc <- center(x)
head(xc)
xc <- center(x)
head(xc)
summary(lm(df$lefdesom) ~ xc))
summary(lm(df$lefdesom ~ xc))
summary(betareg(y ~ xc))
meas <- 'pdw2_upload'
xc_u <- center(x)
summary(betareg(y ~ xc_u))
summary(lm(y ~ xc_u))
meas <- 'pdw2_pcount'
xc_p <- center(x)
summary(lm(y ~ xc_u))
summary(lm(y ~ xc_p))
summary(betareg(y ~ xc_p))
x <- cbind(df$pdw2_download, df$pdw2_download^2, df$pdw2_upload, df$pdw2_upload^2)
head(x)
xx <- x
x <- cbind(xx, x)
head(x)
xc <- center(x)
head(xc)
summary(betareg(y ~ xc))
head(y)
summary(lm(df$lefdesom ~ xc))
names(df)
meas <- 'pdw2_all'
grep(split(meas, '_')[1], names(df), values = TRUE)
grep(strsplit(meas, '_')[1], names(df), values = TRUE)
grep(strsplit(meas, '_')[1], names(df), values = TRUE)
grep(strsplit(meas, '_')[1], names(df), value = TRUE)
grep(strsplit(meas, '_'), names(df), value = TRUE)
strsplit(meas, '_')
grep(strsplit(meas, '_')[[1]], names(df), value = TRUE)
grep(strsplit(meas, '_')[[1]][1], names(df), value = TRUE)
m
dim(x)
head(x)
df$pdw2_download
head(cbind(df$pdw2_download, df$pwd2_download^2))
head(cbind(df$pdw2_download, df$pdw2_download^2))
head(x)
head(cbind(df$pdw2_download, df$pdw2_download^2,df$pdw2_upload,df$pdw2_upload^2,df$pdw2_pcount, df$pdw2_pcount^2))
library(rstan)
library(shinystan)
cdir
odir <- '../../../output/rq1/'
fit <- read_stan_csv(grep('sl_normal_pdw2_all', list.files(odir), value = TRUE))
list.files(odir)
fit <- read_stan_csv(grep('sl_normal_full_pdw2_all', list.files(odir), value = TRUE))
fit <- read_stan_csv(grep('sl_normal_full_pdw2_all', list.files(odir), value = TRUE))
fit <- read_stan_csv(paste0(odir, grep('sl_normal_full_pdw2_all', list.files(odir), value = TRUE)))
launch_shinystan(fit)
fit <- read_stan_csv(paste0(odir, grep('sl_beta_full_pdw2_all', list.files(odir), value = TRUE)))
fit <- read_stan_csv(paste0(odir, grep('sl_normal_two_pdw2_all', list.files(odir), value = TRUE)))
launch_shinystan(fit)
first_level_vars
!('twoyr' %in% first_level_vars)
!grep('twoyr', first_level_vars, value = TRUE)
grep('twoyr', first_level_vars, value = TRUE)
grep([^'twoyr'], first_level_vars, value = TRUE)
grep('[^twoyr]', first_level_vars, value = TRUE)
first_level_vars_two
first_level_vars
fit <- read_stan_csv(paste0(odir, grep('sl_normal_two_pdw2_all', list.files(odir), value = TRUE)))
fit <- read_stan_csv(paste0(odir, grep('sl_normal_two_pdw2_download', list.files(odir), value = TRUE)))
launch_shinystan(fit)
fit <- read_stan_csv(paste0(odir, grep('sl_normal_two_pdw2_download', list.files(odir), value = TRUE)))
launch_shinystan(fit)
launch_shinystan(fit)
fit <- read_stan_csv(paste0(odir, grep('sl_normal_full_pdw2_all', list.files(odir), value = TRUE)))
launch_shinystan(fit)
fit <- read_stan_csv(paste0(odir, grep('sl_normal_two_pdw2_all', list.files(odir), value = TRUE)))
launch_shinystan(fit)
fit <- read_stan_csv(paste0(odir, grep('sl_beta_full_pdw2_download', list.files(odir), value = TRUE)))
launch_shinystan(fit)
fit <- read_stan_csv(paste0(odir, grep('sl_beta_full_pdw2_all', list.files(odir), value = TRUE)))
launch_shinystan(fit)
fit <- read_stan_csv(paste0(odir, grep('vi_normal_full_pdw2_all', list.files(odir), value = TRUE)))
launch_shinystan(fit)
J
table(state)
table(state)
fit <- read_stan_csv(paste0(odir, grep('vi_beta_full_pdw2_all', list.files(odir), value = TRUE)))
launch_shinystan(fit)
exp(.369)
fit <- read_stan_csv(paste0(odir, grep('vs_normal_full_pdw2_all', list.files(odir), value = TRUE)))
fit <- read_stan_csv(paste0(odir, grep('vs_normal_two_pdw2_all', list.files(odir), value = TRUE)))
exp(.369)
launch_shinystan(fit)
fit <- read_stan_csv(paste0(odir, grep('vs_normal_full_pdw2_download', list.files(odir), value = TRUE)))
launch_shinystan(fit)
df %>% distinct(stfips, .keep_all = T) %>% select(stfips, ststan)
df %>% distinct(stfips, .keep_all = T) %>% select(stfips, ststan) %>% data.frame()
df %>% distinct(stfips, .keep_all = T) %>% select(ststan, stfips, stabbr) %>% data.frame()
launch_shinystan(fit)
fit <- read_stan_csv(paste0(odir, grep('vs_beta_full_pdw2_download', list.files(odir), value = TRUE)))
launch_shinystan(fit)
fit <- read_stan_csv(paste0(odir, grep('sl_beta_full_pdw2_all', list.files(odir), value = TRUE)))
launch_shinystan(fit)
fit <- read_stan_csv(paste0(odir, grep('vi_normal_full_pdw2_all', list.files(odir), value = TRUE)))
launch_shinystan(fit)
fit <- read_stan_csv(paste0(odir, grep('vi_beta_full_pdw2_all', list.files(odir), value = TRUE)))
launch_shinystan(fit)
fit <- read_stan_csv(paste0(odir, grep('vs_normal_all_full_pdw2_all', list.files(odir), value = TRUE)))
launch_shinystan(fit)
fit <- read_stan_csv(paste0(odir, grep('vs_normal_all_full_pdw2_all', list.files(odir), value = TRUE)))
launch_shinystan(fit)
quit()
getwd()
library(dplyr)
library(readr)
df <- read_csv('/Users/benski/diss/data/cleaned/rq1/rq1_analysis.csv')
df
df %>% group_by(twoyr) %>% summarise(efdetot = mean(efdetot), efdesom = mean(efdesom))
df %>% group_by(twoyr) %>% summarise(efdetot = sum(efdetot), efdesom = sum(efdesom))
df %>% summarise(twoyr = sum(twoyr))
table(df$twoyr)
df %>% group_by(twoyr) %>% summarise(efdetot = sum(efdetot), efdesom = sum(efdesom), pct = efdesom / dfdetot)
df %>% group_by(twoyr) %>% summarise(efdetot = sum(efdetot), efdesom = sum(efdesom), pct = efdesom / efdetot)
474041 / 2998204
2505825 / 17064591
311 / 2186
311 / (311 + 2186)
474041 / (474041 + 2998204)
2505825 / (2505825 + 17064591
)
2186 - 311
2186 + 311
df %>% group_by(twoyr) %>% summarise(efdetot = sum(efdetot), efdesom = sum(efdesom), pct = efdesom / efdetot, p25 = quantile(efdesom, .25))
summary(df$efdesom)
summary(df$efdesom[df$twoyr == 0])
summary(df$efdesom[df$twoyr == 1])
plot(density(df$efdesom[twoyr == 1]))
plot(density(df$efdesom[df$twoyr == 1]))
plot(density(df$efdesom[df$twoyr == 0]))
plot(density(log(df$efdesom[df$twoyr == 0])))
lines(density(log(df$efdesom[df$twoyr == 1])), color = 'red')
lines(density(log(df$efdesom[df$twoyr == 1])), col= 'red')
df %>% group_by(twoyr) %>% summarise(efdetot = med(efdetot), efdesom = med(efdesom))
df %>% group_by(twoyr) %>% summarise(efdetot = median(efdetot), efdesom = median(efdesom))
df %>% group_by(twoyr) %>% summarise(efdetot = median(efdetot), efdesom = median(efdesom), pct = efdesom / efdetot)
df %>% group_by(twoyr) %>% summarise(efdetot = mean(efdetot), efdesom = mean(efdesom), pct = efdesom / efdetot)
quit()
args <- c('.', '../../data/')
ddir
cdir
check_get('co-est2015-alldata.csv', adir, url)
check_get('co-est2015-alldata.csv', adir, url)
check_get('co-est2015-alldata.csv', adir, url)
